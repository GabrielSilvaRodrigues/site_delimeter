# Configuração para React + PHP Backend
RewriteEngine On

# API routes - sempre vai para PHP
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^(.*)$ public/index.php [L,QSA]

# PHP routes específicos
RewriteCond %{REQUEST_URI} ^/(login|usuario|paciente|nutricionista|medico|conta)/
RewriteRule ^(.*)$ public/index.php [L,QSA]

# Static assets (arquivos estáticos) - serve arquivos existentes
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^(public|build|assets)/ - [L]

# React build assets
RewriteCond %{REQUEST_URI} ^/static/
RewriteCond %{DOCUMENT_ROOT}/build/static/$1 -f
RewriteRule ^static/(.*)$ /build/static/$1 [L]

# Para desenvolvimento - servir do frontend/build se existir
RewriteCond %{DOCUMENT_ROOT}/frontend/build/index.html -f
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/
RewriteCond %{REQUEST_URI} !^/public/
RewriteRule . /frontend/build/index.html [L]

# Fallback para PHP se React não estiver disponível
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/
RewriteRule . /public/index.php [L,QSA]

# Cache static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
</IfModule>